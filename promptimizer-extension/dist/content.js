import{s as a,v as s,a as c,b as l}from"./sanitizer.js";let o="";document.addEventListener("mouseup",()=>{const i=window.getSelection().toString().trim();o=a(i),o&&o.length>10&&s(o)&&chrome.storage.local.set({selectedText:o})});chrome.runtime.onMessage.addListener((e,i,r)=>{if(e.action==="getSelectedText")r({text:o});else if(e.action==="insertOptimizedPrompt")try{const t=document.activeElement;if(!t||!u(t)){r({success:!1,error:"No valid text input found"});return}if(!e.prompt||!s(e.prompt)){console.warn("Blocked unsafe prompt insertion attempt"),r({success:!1,error:"Content blocked for security reasons"});return}let n=!1;t.tagName==="TEXTAREA"||t.tagName==="INPUT"?(n=c(t,e.prompt),n&&t.dispatchEvent(new Event("input",{bubbles:!0}))):t.contentEditable==="true"&&(n=l(t,e.prompt),n&&t.dispatchEvent(new Event("input",{bubbles:!0}))),r({success:n,error:n?null:"Failed to insert content safely"})}catch(t){console.error("Content insertion error:",t),r({success:!1,error:"Insertion failed due to security restrictions"})}});function u(e){if(!e)return!1;const i=e.tagName.toLowerCase(),r=i==="input"||i==="textarea",t=e.contentEditable==="true",n=e.closest("script, style, iframe")!==null;return(r||t)&&!n}
